 \documentclass[t]{beamer}
%\documentclass[c]{beamer}
\listfiles

\mode<presentation>
{
  \usetheme[english,titlepage0]{KIT}
% \usetheme[usefoot]{KIT}
% \usetheme{KIT}

%%  \usefonttheme{structurebold}

  \setbeamercovered{transparent}

  %\setbeamertemplate{enumerate items}[circle]
  \setbeamertemplate{enumerate items}[ball]

}
\usepackage{babel}
%\date{10.05.2010}
%\DateText

\newlength{\Ku}
\setlength{\Ku}{1.43375pt}

\usepackage[latin1]{inputenc}
\usepackage[TS1,T1]{fontenc}
\usepackage{array}
\usepackage{multicol}
\usepackage{lipsum}

\usetikzlibrary{shadows,arrows,positioning,matrix,calc}
\definecolor{kit}{RGB}{0,150,130}
\definecolor{firmred}{RGB}{255,153,153}
\definecolor{firmblue}{RGB}{162,153,246}
\definecolor{firmgreen}{RGB}{153,255,153}
\definecolor{grey}{RGB}{130,130,130}
\tikzset{
	cfn/.style={
		draw,rectangle
	},
	cond/.style={
		fill=firmred
	},
	phi/.style={
		fill=firmgreen
	},
	cf/.style={
		color=firmblue,
		line width=1pt,
	},
	asslabel/.style={
		rectangle,
		text width=1.5cm,
		align=left
	},
	ass/.style={
		rectangle,
		text width=3cm,
		align=left
	},
	assline/.style={
		color=grey,
		align=right
	},
	reglifetime/.style={
		-,
		line width=0.5mm,
		draw=kit
	},
	helplinegrey/.style={
		color=grey
	},
	resultregister/.style={ },
}

%\usenavigationsymbols
%\usenavigationsymbols[sfHhdb]
%\usenavigationsymbols[sfhHb]

\title[]{Compiler: Assembler generation}
%\subtitle{Karlsruhe Institute of Technology (KIT)}

\author[]{KIT}

\AuthorTitleSep{\relax}

\institute[]{KARLSRUHE INSTITUTE OF TECHNOLOGY (KIT)}
%\institute[\raisebox{-4mm}{\includegraphics[height=5mm]{images/OU-Logo}}]
%  {KARLSRUHE INSTITUTE OF TECHNOLOGY (KIT)}
%\logo{\includegraphics[height=12mm]{images/OU-Logo}}

\TitleImage[width=\titleimagewd]{images/20150205_093943}

\newlength{\tmplen}

\newcommand{\verysmall}{\fontsize{6pt}{8.6pt}\selectfont}

\begin{document}

\begin{frame}
  \maketitle
\end{frame}

\begin{frame}
  \frametitle{Principial procedure}

\begin{tikzpicture}
% Graph
\input{tkiz/sample_graph.tex}


\visible<2-> {
% Arrow
\fill [kit!20] (4.8,0.25) -- (4.8,0.5) -- (5.75,0.5) -- (5.75,0.25) -- (6.25,0.75) -- (5.75,1.25) -- (5.75,1) -- (4.8,1) -- cycle;

% Assembler
\input{tkiz/sample_assembler.tex}
}
\end{tikzpicture}

\visible<3-> {
Challenges:
}
\begin{itemize}
\visible<3-> { \item Firm nodes not extendable in jFirm }
\visible<4-> { \item Two operand code in x86 64 assembler:\\
$R2 \leftarrow add 2, R1$ $\Rightarrow$ $mov\ R1, R2$; $add\ 2, R2$ }
\visible<5-> { \item Register allocation }
\end{itemize}
\end{frame}


\begin{frame}
  \frametitle{Register Allocation: Linear Scan}

\begin{itemize}
\item Precondition: Linear register code
\visible<5-> { \item Result: Mapping of Registers to Hardware-Registers }
\end{itemize}

\begin{tikzpicture}
\visible<2-> {
	\input{tkiz/sample_assembler.tex}
	\input{tkiz/sample_assembler_linenumber.tex}
}

\visible<3-> {
\node []	at (13,2.5)				(reg1)		{ $R1$ };
\node [right=5mm of reg1]				(reg2)		{ $R2$ };
\node [right=5mm of reg2]				(reg3)		{ $R3$ };
\node [right=5mm of reg3]				(reg4)		{ $R4$ };
}

\visible<4-> {
\draw[helplinegrey] (aass)		-- ++ (7.5cm, 0);
\draw[helplinegrey] (acond)		-- ++ (7.5cm, 0);
\draw[helplinegrey] (acondjmp1)	-- ++ (7.5cm, 0);
\draw[helplinegrey] (acondjmp2)	-- ++ (7.5cm, 0);
\draw[helplinegrey] (ifass)		-- ++ (7.5cm, 0);
\draw[helplinegrey] (ifjmp)		-- ++ (7.5cm, 0);
\draw[helplinegrey] (elseass)		-- ++ (7.5cm, 0);
\draw[helplinegrey] (elsejmp)		-- ++ (7.5cm, 0);
\draw[helplinegrey] (endnode)		-- ++ (7.5cm, 0);

\draw[reglifetime] ($(reg1.south)+(0,-0.25)$) -- ++ ($(elseass.west)-(aass.west)$);
\draw[reglifetime] ($(reg2.south)+(0,-0.25)-(aass.west)+(ifass.west)$) -- ++ ($(endnode.west)-(ifass.west)$);
\draw[reglifetime] ($(reg3.south)+(0,-0.25)-(aass.west)+(elseass.west)$) --	++ ($(endnode.west)-(elseass.west)$);
\draw[reglifetime] ($(reg4.south)+(0,-0.25)-(aass.west)+(endnode.west)$) -- ++ (0,-0.3);
\draw[reglifetime,dotted] ($(reg4.south)+(0,-0.25)-(aass.west)+(endnode.west)-(0,0.29)$) -- ++ (0,-0.3);

}

\visible<5-> {
\node[resultregister,below=4.5cm of reg1] () { \textbf{\%rax} };
\node[resultregister,below=4.5cm of reg2] () { \textbf{\%rbx} };
\node[resultregister,below=4.5cm of reg3] () { \textbf{\%rax} };
\node[resultregister,below=4.5cm of reg4] () { \textbf{\%rax} };
}

\end{tikzpicture}

\end{frame}
\end{document}
